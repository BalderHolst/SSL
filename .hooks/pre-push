#!/bin/sh

# This script was generated by Nix.
# To make changes edit nix configuration.

echo "->> Running 'pre-push'"
# Dependencies for pre-push
echo "--->> Running 'gen-scripts'"
# Dependencies for gen-scripts

# Run gen-scripts task
nix run .#gen-scripts

echo "--->> Running 'check-fmt'"
# Dependencies for check-fmt

# Run check-fmt task
cargo fmt --check --manifest-path "`git rev-parse --show-toplevel`/././Cargo.toml" \
    || { echo -e "\nPlease format your files in './.'.";  exit 1; }

cargo fmt --check --manifest-path "`git rev-parse --show-toplevel`/./demo//Cargo.toml" \
    || { echo -e "\nPlease format your files in './demo/'.";  exit 1; }



echo "--->> Running 'check-clippy'"
# Dependencies for check-clippy

# Run check-clippy task
cargo clippy --manifest-path "`git rev-parse --show-toplevel`/././Cargo.toml" -- --deny warnings 2> /dev/null \
    || { echo -e "\nClippy is angry in './.'."; exit 1; }

cargo clippy --manifest-path "`git rev-parse --show-toplevel`/./demo//Cargo.toml" -- --deny warnings 2> /dev/null \
    || { echo -e "\nClippy is angry in './demo/'."; exit 1; }



echo "--->> Running 'check-examples'"
# Dependencies for check-examples
echo "----->> Running 'build'"
# Dependencies for build

# Run build task
cargo build --release --manifest-path "`git rev-parse --show-toplevel`/././Cargo.toml"


# Run check-examples task
ls ./examples | xargs -I{} bash -c \
    "echo 'Checking example {}' ; ./target/release/ssl examples/{} --expr --dry-run | diff - tests/{}.expr || exit 1" \
    || { echo "Example AST has changed." ; exit 1 ; }


echo "--->> Running 'demo-generate-favicon'"
# Dependencies for demo-generate-favicon

# Run demo-generate-favicon task
root="`git rev-parse --show-toplevel`"
echo "Stupid Shader Language" | cargo run -- /dev/stdin -W 16 -H 16 -o $root/demo/favicon.png
mv -v $root/demo/favicon.png $root/demo/favicon.ico


echo "--->> Running 'check-no-uncommited'"
# Dependencies for check-no-uncommited

# Run check-no-uncommited task
git update-index --refresh > /dev/null
    git diff-index --quiet HEAD -- || {
        echo "Please commit your changes before pushing."
            exit 1
    }


# Run pre-push task

